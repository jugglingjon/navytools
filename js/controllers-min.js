app.controller("chapterController",function(e,t,a){function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,a;return("x"==e?t:3&t|8).toString(16)})}function r(){console.log(e.chapters[e.chapterID].correctPercent)}function s(){var t=0;for(var a in e.chapters[e.chapterID].answered){var n=e.chapters[e.chapterID].answered[a];e.questions[e.chapterID].questions[a].answers[n].correct&&t++}e.chapters[e.chapterID].correctCount=t,e.chapters[e.chapterID].correctPercent=Math.floor(e.chapters[e.chapterID].correctCount/e.questions[e.chapterID].questions.length*100),r(),window.localStorage[c]=JSON.stringify(e.chapters)}function o(t){function a(){$("#search").val("").trigger("keyup"),$("figure").each(function(){var e=$(this).attr("data-id");if($(this).hasClass("video")){$(this).prepend("<span>Figure "+e+"</span> &mdash; "),$(this).wrapInner("<figcaption></figcaption>");var t,a=$('<video controls src="'+("media/"+e+".mp4")+'">');$(this).prepend(a)}else{$(this).attr("data-frames")&&(e+=$(this).attr("data-frames").split(",")[0]),$(this).prepend("<span>Figure "+e+"</span> &mdash; "),$(this).wrapInner("<figcaption></figcaption>");var n,r=$('<img src="'+("media/"+e+".jpg")+'">');$(this).prepend(r)}}),$(".alert-note").each(function(){$(this).prepend("<h5>NOTE</h5>")}),$(".alert-warning").each(function(){$(this).prepend('<h5><i class="icon mdi mdi-warning"></i>WARNING<i class="icon mdi mdi-warning"></i></h5>')}),$(".alert-caution").each(function(){$(this).prepend('<h5><i class="icon mdi mdi-warning"></i>CAUTION<i class="icon mdi mdi-warning"></i></h5>')})}e.chapters=t,s(),e.bookmarkToggle=function(){1==e.chapters[e.chapterID].bookmarked?e.chapters[e.chapterID].bookmarked=!1:e.chapters[e.chapterID].bookmarked=!0,$(".bookmark-toggle-btn").toggleClass("bookmarked"),s()},e.openChapter=function(t){e.chapterID=t,23===e.chapterID?e.translatedChapterID="A1":e.translatedChapterID="A2",e.chapterQuestions=e.questions[t].questions,$(".portal").empty().load(t+".html",function(){for(var t in e.chapters[e.chapterID].answered)$(".quiz").eq(parseInt(t)).find(".quiz-answer").eq(e.chapters[e.chapterID].answered[t]).addClass("selected");a(),r()})},e.selectAnswer=function(t){var a=$(t.target);a.addClass("selected").siblings().removeClass("selected");var n=a.parent().children().index(a),r=a.closest(".quiz").index(".quiz");return e.chapters[e.chapterID].answered||(e.chapters[e.chapterID].answered={}),e.chapters[e.chapterID].answered[r]=n,s(),!1},e.testSelectAnswer=function(t,a,n){var r;return $(t.target).addClass("selected").siblings().removeClass("selected"),e.currentTestData.questions[a].selected=n,console.log(e.currentTestData),!1},e.openChapter(e.chapterID)}e.version="1.4",e.numbersToLetters={0:"A",1:"B",2:"C",3:"D"},e.startChapter=1,e.chapterID=e.startChapter;var c="NETCtoolsAlphaChaptersC";a.get("chapterQuestions.json").then(function(t){e.questions=t.data,window.localStorage[c]?o(JSON.parse(window.localStorage[c])):a.get("chapters.json").then(function(e){o(e.data)})}),e.initTest=function(){e.testing=!0,a.get("test.json").then(function(t){for(key in e.allTestData=t.data,e.testMapping=[],e.allTestData)e.testMapping.push(key);console.log(e.testMapping),e.currentTestIndex=0,e.currentTestData=e.allTestData[e.testMapping[e.currentTestIndex]]})},e.modalAlert=function(e,t){$("#alertModal .modal-title").text(e),$("#alertModal .modal-body").text(t),$("#alertModal").modal()},e.loadTest=function(t){$(".test-area .quiz").length===$(".test-area .quiz a.selected").length||t<e.currentTestIndex?(e.currentTestIndex=t,e.currentTestData=e.allTestData[e.testMapping[e.currentTestIndex]]):e.modalAlert("Missing Answers","Answer all questions before proceeding.")},e.answerClass=function(t,a){var n="";return e.currentTestData.questions[t].answers[a].correct?n+="test-correct ":n+="test-incorrect ",e.currentTestData.questions[t].selected>=0&&e.currentTestData.questions[t].selected===a&&(n+="selected "),n},e.sendCert=function(){var t=n(),a=$(window).width()>500?"Tablet":"Phone",r=`<?xml version="1.0" encoding="utf-8"?>\n<course_completion>\n\t<Course_Completion_ID>${t}</Course_Completion_ID>\n\t<DODID>${e.dodid}</DODID>\n\t<Course_Number>NRTC-NAVEDTRA-14256A-TEST</Course_Number>\n\t<Pre_Test_Score>0</Pre_Test_Score>\n\t<Post_Test_Score>${e.score}</Post_Test_Score>\n\t<Completion_Date>${moment().format()}</Completion_Date>\n\t<Device_Information>\n\t\t<Device_Manufacturer>${device.manufacturer}</Device_Manufacturer>\n\t\t<Device_Model>${device.model}</Device_Model>\n\t\t<Device_Type>${a}</Device_Type>\n\t\t<Device_OS_Name>${device.platform}</Device_OS_Name>\n\t\t<Device_OS_Version>${device.version}</Device_OS_Version>\n\t</Device_Information>\n</course_completion>`;console.log(r);var s=Base64.encode(r),o=b64toBlob(s,"text/xml"),c=new JSZip;return c.file(t+".xml",o),c.generateAsync({type:"blob"}).then(function(e){var a=new FileReader;a.readAsDataURL(e),a.onloadend=function(){base64data=a.result,console.log(base64data.substr(base64data.indexOf(",")+1));var e="base64:"+t+".idk//"+base64data.substr(base64data.indexOf(",")+1);cordova.plugins.email.open({to:"NTMPS.Mobile.Support@navy.mil",subject:"Completion Certificate",body:"NRTC-NAVEDTRA-14256A-TEST\n\nDo not change the subject line of this email. Changing the subject line may prevent credit for completing this course.",attachments:[e]})}}),!1},e.gradeTest=function(){var t=[];for(key in e.allTestData)$.each(e.allTestData[key].questions,function(){t.push(this)});for(var a=0,n=t.length,r=0;r<t.length;r++)t[r].selected>=0&&t[r].answers[t[r].selected].correct&&a++;console.log(a,n,a/n),e.score=a/n,e.passed=e.score>=.8,e.score=Math.floor(100*e.score),$("#gradeModal").modal({backdrop:"static"})},e.xgradeTest=function(){var t=[];$.each(e.allTestData[e.currentTestIndex].questions,function(){t.push(this)}),console.log(t);for(var a=0,n=t.length,r=0;r<t.length;r++)t[r].selected>=0&&t[r].answers[t[r].selected].correct&&a++;console.log(a,n,a/n)},e.resetData=function(){confirm("This will reset all bookmarks and saved progress, do you want to continue?")&&a.get("chapters.json").then(function(e){$(".quiz-answer").removeClass("selected"),o(e.data)})}});